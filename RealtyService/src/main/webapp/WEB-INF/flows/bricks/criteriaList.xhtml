<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui" xmlns:sec="http://www.springframework.org/security/tags"        >
    <h:panelGrid columns="1">
        <p:messages autoUpdate="true"/>
        <p:commandButton value="#{ui.ADD_CRITERIA}" actionListener="#{preferences.addCriteria}" update="criteriaTable"
                         styleClass="btn btn-primary"
                         icon="icon-user"/>
        <p:dataTable id="criteriaTable" value="#{preferences.getCriteriaList()}" var="criteria">
            <!-- Обрати тип нерухомості -->
            <p:column headerText="#{ui.REALTY_TYPE}">
                <p:selectOneMenu value="#{criteria.productType}" required="true"
                                 requiredMessage="#{ui.ERR_CHOOSE_REALTY_TYPE}">
                    <f:selectItem itemLabel="#{ui.CHOOSE_REALTY_TYPE}" itemValue="#{null}"/>
                    <f:selectItems var="realtyType" itemLabel="#{ui[realtyType.name()]}"
                                   value="#{preferences.realtyUnits}"/>
                    <p:ajax update="criteriaTable" process="@this"/>
                </p:selectOneMenu>
            </p:column>

            <!-- Обрати тип операції -->
            <p:column headerText="#{ui.OPERATION_TYPE}">
                    <p:selectOneMenu value="#{criteria.operation}" required="true"
                                     requiredMessage="#{ui.ERR_CHOOSE_OPERATION}" label="#{ui.CHOOSE_OPERATION}"
                                     rendered="#{criteria.productType != null}" panelStyle="width:220px">
                        <f:selectItem itemLabel="#{ui.CHOOSE_OPERATION}" itemValue="#{null}"/>
                        <f:selectItems var="realtyOperation" itemLabel="#{ui[realtyOperation]}"
                                       value="#{preferences.getOperationTypes(criteria.productType)}"/>
                        <p:ajax update="criteriaTable" process="@this"/>
                    </p:selectOneMenu>
            </p:column>

            <!-- Обрати тип операції -->
            <p:column headerText="#{ui.CHOOSE_LOCATION}" style="width:24%">
                    <p:selectOneMenu value="#{criteria.location}" label="#{ui.CHOOSE_LOCATION}"
                                     rendered="#{criteria.operation != null}" panelStyle="width:220px">
                        <f:selectItems var="location" itemLabel="#{ui[location]}"
                                       value="#{preferences.realtyLocations}"/>
                    </p:selectOneMenu>
            </p:column>

            <p:column id="parCol" headerText="" style="width:24%" rendered="#{criteria.operation != null}">
                <f:facet name="header">#{ui.PARAMETERS}</f:facet>
                <p:rowToggler />
            </p:column>

            <p:rowExpansion>
                <ui:include src="parameters.xhtml">
                    <ui:param name="preferences" value="#{preferences}" />
                </ui:include>
            </p:rowExpansion>

        </p:dataTable>
    </h:panelGrid>
</ui:composition>